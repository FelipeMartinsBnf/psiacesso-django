{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Complete seu Perfil de Psicólogo</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    rel="stylesheet"
  />

  <link rel="stylesheet" href="{% static 'globals.css' %}" />
  <link rel="stylesheet" href="{% static 'cadastro.css' %}" />
  <link rel="stylesheet" href="{% static 'cadastro_psicologo.css' %}" />
</head>
<body class="bg-light d-flex align-items-center justify-content-center vh-100">
  <div class="container">

    
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">
        <div class="card shadow-lg p-4 rounded-4">
          <div class="card-body">
            <h2 class="text-center mb-3">Complete seu Perfil de Psicólogo</h2>
            <p class="text-center text-muted mb-4">
              Preencha as informações abaixo para finalizar seu cadastro.
            </p>

            <form method="post" class="needs-validation" novalidate>
              {% csrf_token %}
              {{ form.as_p }}

              <hr class="my-4" />

              <h4 class="mb-3">Formação Acadêmica e Cursos</h4>

              <div id="formacao-list" class="mb-3">
                {{ formset.management_form }}
                {% for form_item in formset %}
                  <div class="border rounded-3 p-3 mb-3 bg-white">
                    <h5 class="mb-3">Formação {{ forloop.counter }}</h5>
                    {{ form_item.as_p }}
                    {% if form_item.instance.pk and formset.can_delete %}
                      <div class="form-check mt-2">
                        {{ form_item.DELETE }}
                        <label class="form-check-label" for="{{ form_item.DELETE.id_for_label }}">
                          Marcar para remover
                        </label>
                      </div>
                    {% endif %}
                  </div>
                {% endfor %}
              </div>

              <div class="d-grid gap-2 mb-4">
                <button
                  type="button"
                  id="add-formacao-button"
                  class="btn btn-outline-primary rounded-3"
                >
                  <i class="fas fa-plus me-2"></i>Adicionar mais uma formação
                </button>
              </div>

              <div id="empty-form" class="d-none">
                <div class="border rounded-3 p-3 mb-3 bg-white">
                  <h5>Formação <span class="form-counter"></span></h5>
                  {{ formset.empty_form.as_p }}
                </div>
              </div>

              <div class="d-grid">
                <button type="submit" class="btn btn-primary rounded-3">
                  <i class="fas fa-save me-2"></i>Salvar Perfil
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const addFormacaoButton = document.getElementById("add-formacao-button");
    const formacaoList = document.getElementById("formacao-list");
    const emptyForm = document.getElementById("empty-form").innerHTML;
    const totalFormsInput = document.getElementById("id_formacoes-TOTAL_FORMS");

    addFormacaoButton.addEventListener("click", function () {
      let currentFormCount = parseInt(totalFormsInput.value);
      const newFormHtml = emptyForm.replace(/__prefix__/g, currentFormCount);

      const newFormElement = document.createElement("div");
      newFormElement.innerHTML = newFormHtml;
      newFormElement
        .querySelector(".form-counter")
        .innerText = currentFormCount + 1;

      formacaoList.appendChild(newFormElement);
      totalFormsInput.value = currentFormCount + 1;
    });
  </script>
</body>
</html>
